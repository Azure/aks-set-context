name: 'Run L0 tests.'
on: # rebuild any PRs and main branch changes
   pull_request:
      branches:
         - main
         - 'releases/*'
   push:
      branches:
         - main
         - 'releases/*'

jobs:
   build:
      runs-on: ubuntu-latest
      steps:
         - uses: actions/checkout@v6

         - name: Install dependencies
           run: npm ci

         - name: Build bundle
           run: npm run build

         - name: Upload bundle artifact
           uses: actions/upload-artifact@v4
           with:
              name: action-bundle
              path: lib/index.js

   unit-tests:
      runs-on: ubuntu-latest
      steps:
         - uses: actions/checkout@v6

         - name: Run unit tests
           run: |
              npm install
              npm test

   integration-tests:
      runs-on: ubuntu-latest
      needs: build
      steps:
         - uses: actions/checkout@v6

         - name: Download bundle artifact
           uses: actions/download-artifact@v4
           with:
              name: action-bundle
              path: lib

         - name: Run integration test
           run: node scripts/integration-test.mjs
